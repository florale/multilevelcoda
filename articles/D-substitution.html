<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<!-- Inform modern browsers that this page supports both dark and light color schemes,
  and the page author prefers light. --><meta name="color-scheme" content="dark light">
<script>
  // If `prefers-color-scheme` is not supported, fall back to light mode.
  // i.e. In this case, inject the `light` CSS before the others, with
  // no media filter so that it will be downloaded with highest priority.
  if (window.matchMedia("(prefers-color-scheme: dark)").media === "not all") {
    document.documentElement.style.display = "none";
    document.head.insertAdjacentHTML(
      "beforeend",
      "<link id=\"css\" rel=\"stylesheet\" href=\"https://bootswatch.com/5/flatly/bootstrap.css\" onload=\"document.documentElement.style.display = ''\">"
    );
  }
</script><title>Compositional Substitution Multilevel Analysis • multilevelcoda</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Compositional Substitution Multilevel Analysis">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Flatly Theme - Light  --><link id="css-light" rel="stylesheet" href="https://bootswatch.com/5/flatly/bootstrap.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<!-- Darkly Theme - Dark --><link id="css-dark" rel="stylesheet" href="https://bootswatch.com/5/darkly/bootstrap.css" media="(prefers-color-scheme: dark)">
<!-- preferably CSS --><link rel="stylesheet" href="../preferably.css">
<link id="css-code-light" rel="stylesheet" href="../code-color-scheme-light.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<link id="css-code-dark" rel="stylesheet" href="../code-color-scheme-dark.css" media="(prefers-color-scheme: dark)">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">multilevelcoda</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/A-introduction.html">Introduction to Bayesian Compositional Multilevel Modelling</a></li>
    <li><a class="dropdown-item" href="../articles/B-composition-MLM.html">Multilevel Models with Compositional Predictors</a></li>
    <li><a class="dropdown-item" href="../articles/C-composition-MMLM.html">Multilevel Model with Compositional Outcomes</a></li>
    <li><a class="dropdown-item" href="../articles/D-substitution.html">Compositional Substitution Multilevel Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/E-simmodel-diag.html">Improving MCMC Sampling for Bayesian Compositional Multilevel Models</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/florale/multilevelcoda/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>




      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Compositional Substitution Multilevel Analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/florale/multilevelcoda/blob/main/vignettes/D-substitution.Rmd" class="external-link"><code>vignettes/D-substitution.Rmd</code></a></small>
      <div class="d-none name"><code>D-substitution.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="intro">Intro<a class="anchor" aria-label="anchor" href="#intro"></a>
</h2>
<p>When examining the relationship between a composition and an
outconme, we are often are interested in how an outcome changes when a
fixed unit in the composition (e.g., minutes of behaviours during a day)
is reallocated from one component to another. The Compositional
Isotemporal Substitution Analysis can be used to estimate this change.
The <code>multilevelcoda</code> package implements this method in a
multilevel framework and offers functions for both between- and
within-person levels of variability. We discuss 4 different substitution
models in this vignette.</p>
<p>We will begin by loading necessary packages,
<code>multilevelcoda</code>, <code>brms</code> (for models fitting),
doFuture (for parallelisation), and data sets <code>mcompd</code>
(simulated compositional sleep and wake variables), <code>sbp</code>
(sequential binary partition), and <code>psub</code> (base possible
substitution).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://florale.github.io/multilevelcoda/">multilevelcoda</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms" class="external-link">brms</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://doFuture.futureverse.org" class="external-link">doFuture</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"mcompd"</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"sbp"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"psub"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="co"># reduce number of digits shown</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fitting-main-model">Fitting main model<a class="anchor" aria-label="anchor" href="#fitting-main-model"></a>
</h2>
<p>Let’s fit our main <code>brms</code> model predicting
<code>Stress</code> from both between and within-person sleep-wake
behaviours (represented by isometric log ratio coordinates), with sex as
a covariate, using the <code><a href="../reference/brmcoda.html">brmcoda()</a></code> function. We can compute
ILR coordinate predictors using <code><a href="../reference/complr.html">complr()</a></code> function.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cilr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/complr.html">complr</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mcompd</span>, sbp <span class="op">=</span> <span class="va">sbp</span>,</span>
<span>                parts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TST"</span>, <span class="st">"WAKE"</span>, <span class="st">"MVPA"</span>, <span class="st">"LPA"</span>, <span class="st">"SB"</span><span class="op">)</span>, idvar <span class="op">=</span> <span class="st">"ID"</span>, total <span class="op">=</span> <span class="fl">1440</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brmcoda.html">brmcoda</a></span><span class="op">(</span>complr <span class="op">=</span> <span class="va">cilr</span>,</span>
<span>             formula <span class="op">=</span> <span class="va">Stress</span> <span class="op">~</span> <span class="va">bz1_1</span> <span class="op">+</span> <span class="va">bz2_1</span> <span class="op">+</span> <span class="va">bz3_1</span> <span class="op">+</span> <span class="va">bz4_1</span> <span class="op">+</span></span>
<span>                                <span class="va">wz1_1</span> <span class="op">+</span> <span class="va">wz2_1</span> <span class="op">+</span> <span class="va">wz3_1</span> <span class="op">+</span> <span class="va">wz4_1</span> <span class="op">+</span> <span class="va">Female</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">ID</span><span class="op">)</span>,</span>
<span>             cores <span class="op">=</span> <span class="fl">8</span>, seed <span class="op">=</span> <span class="fl">123</span>, backend <span class="op">=</span> <span class="st">"cmdstanr"</span><span class="op">)</span></span></code></pre></div>
<p>A <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> of the model results.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span><span class="co">#&gt;  Family: gaussian </span></span>
<span><span class="co">#&gt;   Links: mu = identity; sigma = identity </span></span>
<span><span class="co">#&gt; Formula: Stress ~ bz1_1 + bz2_1 + bz3_1 + bz4_1 + wz1_1 + wz2_1 + wz3_1 + wz4_1 + Female + (1 | ID) </span></span>
<span><span class="co">#&gt;    Data: tmp (Number of observations: 3540) </span></span>
<span><span class="co">#&gt;   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;</span></span>
<span><span class="co">#&gt;          total post-warmup draws = 4000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multilevel Hyperparameters:</span></span>
<span><span class="co">#&gt; ~ID (Number of levels: 266) </span></span>
<span><span class="co">#&gt;               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; sd(Intercept)     0.99      0.06     0.87     1.11 1.00     1574     2367</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Regression Coefficients:</span></span>
<span><span class="co">#&gt;           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; Intercept     2.65      0.48     1.69     3.56 1.00     1494     2202</span></span>
<span><span class="co">#&gt; bz1_1         0.11      0.32    -0.53     0.74 1.00      967     1699</span></span>
<span><span class="co">#&gt; bz2_1         0.50      0.34    -0.16     1.15 1.00     1081     2071</span></span>
<span><span class="co">#&gt; bz3_1         0.11      0.21    -0.31     0.53 1.00     1059     2057</span></span>
<span><span class="co">#&gt; bz4_1         0.04      0.28    -0.51     0.60 1.00     1266     2174</span></span>
<span><span class="co">#&gt; wz1_1        -0.34      0.12    -0.58    -0.09 1.00     2797     2882</span></span>
<span><span class="co">#&gt; wz2_1         0.05      0.13    -0.21     0.32 1.00     3134     2299</span></span>
<span><span class="co">#&gt; wz3_1        -0.10      0.08    -0.26     0.06 1.00     2712     2653</span></span>
<span><span class="co">#&gt; wz4_1         0.24      0.10     0.04     0.44 1.00     2963     2874</span></span>
<span><span class="co">#&gt; Female       -0.41      0.17    -0.77    -0.07 1.00     1364     1823</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Further Distributional Parameters:</span></span>
<span><span class="co">#&gt;       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; sigma     2.38      0.03     2.33     2.44 1.00     4866     2981</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Draws were sampled using sample(hmc). For each parameter, Bulk_ESS</span></span>
<span><span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span><span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></span></code></pre></div>
<p>We can see that the first and forth within-person ILR coordinates
were both associated with stress. Interpretation for multilevel ILR
coordinates can often be less intuitive. For example, the significant
coefficient for wz1_1 shows that the within-person change in sleep
behaviours (sleep duration and time awake in bed combined), relative to
wake behaviours (moderate to vigorous physical activity, light physical
activity, and sedentary behaviour) on a given day, is associated with
stress. However, as there are several behaviours involved in this
coordinate, we don’t know the within-person change in which of them
drives the association. It could be the change in sleep, such that
people sleep more than their own average on a given day, but it could
also be the change in time awake. Further, we don’t know about the
specific changes in time spent across behaviours. That is, if people
sleep more, what behaviour do they spend less time in?</p>
<p>This is common issue when working with multilevel compositional data
as ILR coordinates often contains information about multiple
compositional components. To gain further insights into these
associations and help with interpretation, we can conduct post-hoc
analyses using the substitution models from our <code>multilevel</code>
package.</p>
</div>
<div class="section level2">
<h2 id="substitution-models">Substitution models<a class="anchor" aria-label="anchor" href="#substitution-models"></a>
</h2>
<p><code>multilevelcoda</code> package provides <code>2</code> different
methods to compute substitution models, via the
<code><a href="../reference/substitution.html">substitution()</a></code> function.</p>
<p>Basic substitution models:</p>
<ul>
<li>
<em>Between-person</em> substitution</li>
<li>
<em>Within-person</em> substitution</li>
</ul>
<p>Average marginal substitution models:</p>
<ul>
<li>Average marginal <em>between-person</em> substitution</li>
<li>Average marginal <em>within-person</em> substitution</li>
</ul>
<p><em>Tips: Substitution models are often computationally demanding
tasks. You can speed up the models using parallel execution, for
example, using <code>doFuture</code> package.</em></p>
<div class="section level3">
<h3 id="basic-substitution-analysis">Basic Substitution Analysis<a class="anchor" aria-label="anchor" href="#basic-substitution-analysis"></a>
</h3>
<p>The below example examines the changes in stress for different
pairwise substitution of sleep-wake behaviours for a period of 1 to 5
minutes, at between-person level. We specify
<code>level = between</code> to indicate substitutional change would be
at the between-person level, and <code>ref = "grandmean"</code> to
indicate substitution model using the grand compositional mean as
reference composition. If your model contains covariates,
<code><a href="../reference/substitution.html">substitution()</a></code> will average predictions across levels of
covariates as the default.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/substitution.html">substitution</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">m</span>, delta <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,</span>
<span>                      ref <span class="op">=</span> <span class="st">"grandmean"</span>, level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"between"</span>, <span class="st">"within"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Output from <code><a href="../reference/substitution.html">substitution()</a></code> contains multiple data set of
results for all available compositional component. Here are the results
for changes in stress when sleep (TST) is substituted for 10
minutes.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">subm1</span>, delta <span class="op">=</span> <span class="fl">10</span>, level <span class="op">=</span> <span class="st">"between"</span>, to <span class="op">=</span> <span class="st">"TST"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">Mean</th>
<th align="right">CI_low</th>
<th align="right">CI_high</th>
<th align="right">Delta</th>
<th align="left">From</th>
<th align="left">To</th>
<th align="left">Level</th>
<th align="left">Reference</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.06</td>
<td align="right">-0.01</td>
<td align="right">0.13</td>
<td align="right">10</td>
<td align="left">WAKE</td>
<td align="left">TST</td>
<td align="left">between</td>
<td align="left">grandmean</td>
</tr>
<tr class="even">
<td align="right">0.01</td>
<td align="right">-0.03</td>
<td align="right">0.04</td>
<td align="right">10</td>
<td align="left">MVPA</td>
<td align="left">TST</td>
<td align="left">between</td>
<td align="left">grandmean</td>
</tr>
<tr class="odd">
<td align="right">0.01</td>
<td align="right">-0.01</td>
<td align="right">0.03</td>
<td align="right">10</td>
<td align="left">LPA</td>
<td align="left">TST</td>
<td align="left">between</td>
<td align="left">grandmean</td>
</tr>
<tr class="even">
<td align="right">0.01</td>
<td align="right">-0.01</td>
<td align="right">0.04</td>
<td align="right">10</td>
<td align="left">SB</td>
<td align="left">TST</td>
<td align="left">between</td>
<td align="left">grandmean</td>
</tr>
</tbody>
</table>
<p>None of them are significant, given that the credible intervals did
not cross 0, showing that increasing sleep (TST) at the expense of any
other behaviours was not associated in changes in stress at
between-person level. These results can be plotted to see the patterns
more easily using the <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> function.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">subm1</span>, to <span class="op">=</span> <span class="st">"TST"</span>, level <span class="op">=</span> <span class="st">"between"</span>, ref <span class="op">=</span> <span class="st">"grandmean"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="mlmcoda-mlmcoda-plotbsubm1-1.png" alt="Example of Between-person Substitution Analysis"><p class="caption">
Example of Between-person Substitution Analysis
</p>
</div>
<p>Here are the results for within-person level.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">subm1</span>, delta <span class="op">=</span> <span class="fl">10</span>, level <span class="op">=</span> <span class="st">"within"</span>, to <span class="op">=</span> <span class="st">"TST"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">Mean</th>
<th align="right">CI_low</th>
<th align="right">CI_high</th>
<th align="right">Delta</th>
<th align="left">From</th>
<th align="left">To</th>
<th align="left">Level</th>
<th align="left">Reference</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.04</td>
<td align="right">0.01</td>
<td align="right">0.07</td>
<td align="right">10</td>
<td align="left">WAKE</td>
<td align="left">TST</td>
<td align="left">within</td>
<td align="left">grandmean</td>
</tr>
<tr class="even">
<td align="right">-0.01</td>
<td align="right">-0.02</td>
<td align="right">0.01</td>
<td align="right">10</td>
<td align="left">MVPA</td>
<td align="left">TST</td>
<td align="left">within</td>
<td align="left">grandmean</td>
</tr>
<tr class="odd">
<td align="right">-0.01</td>
<td align="right">-0.02</td>
<td align="right">0.00</td>
<td align="right">10</td>
<td align="left">LPA</td>
<td align="left">TST</td>
<td align="left">within</td>
<td align="left">grandmean</td>
</tr>
<tr class="even">
<td align="right">0.00</td>
<td align="right">-0.01</td>
<td align="right">0.01</td>
<td align="right">10</td>
<td align="left">SB</td>
<td align="left">TST</td>
<td align="left">within</td>
<td align="left">grandmean</td>
</tr>
</tbody>
</table>
<p>At within-person level, we got some significant results for
substitution of sleep (TST) and time awake in bed (WAKE) for 5 minutes,
but not other behaviours. Increasing 5 minutes in sleep at the expense
of time spent awake in bed predicted 0.04 higher stress [95% CI 0.01,
0.7], on a given day. Let’s also plot theses results.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">subm1</span>, to <span class="op">=</span> <span class="st">"TST"</span>, level <span class="op">=</span> <span class="st">"within"</span>, ref <span class="op">=</span> <span class="st">"grandmean"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="mlmcoda-mlmcoda-plotwsubm1-1.png" alt="Example of Within-person Substitution Analysis"><p class="caption">
Example of Within-person Substitution Analysis
</p>
</div>
</div>
<div class="section level3">
<h3 id="average-marginal-substitution-effects">Average Marginal Substitution Effects<a class="anchor" aria-label="anchor" href="#average-marginal-substitution-effects"></a>
</h3>
<p>The average marginal models use the unit compositional mean as the
reference composition to obtain the average of the predicted group-level
changes in the outcome when every unit (e.g., individual) in the sample
reallocates a specific unit from one compositional part to another. This
is difference from the basic substitution model which yields prediction
conditioned on an “average” person in the data set (e.g., by using the
grand compositional mean as the reference composition). Average
substitution models models are generally more computationally expensive
than basic subsitution models. All models can be run faster in shorter
walltime using parallel execution. In this example, we set
<code>cores = 5</code>. <code><a href="../reference/substitution.html">substitution()</a></code> will run 5
substitution models for 5 sleep-wake behaviours by parallel excuting
them across 5 workers.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subm2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/substitution.html">substitution</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">m</span>, delta <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,</span>
<span>                      ref <span class="op">=</span> <span class="st">"clustermean"</span>, level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"between"</span>, <span class="st">"within"</span><span class="op">)</span>,</span>
<span>                      cores <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p>Below are the results.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">subm2</span>, delta <span class="op">=</span> <span class="fl">10</span>, to <span class="op">=</span> <span class="st">"TST"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">Mean</th>
<th align="right">CI_low</th>
<th align="right">CI_high</th>
<th align="right">Delta</th>
<th align="left">To</th>
<th align="left">From</th>
<th align="left">Level</th>
<th align="left">Reference</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.07</td>
<td align="right">-0.01</td>
<td align="right">0.15</td>
<td align="right">10</td>
<td align="left">TST</td>
<td align="left">WAKE</td>
<td align="left">between</td>
<td align="left">clustermean</td>
</tr>
<tr class="even">
<td align="right">0.01</td>
<td align="right">-0.03</td>
<td align="right">0.04</td>
<td align="right">10</td>
<td align="left">TST</td>
<td align="left">MVPA</td>
<td align="left">between</td>
<td align="left">clustermean</td>
</tr>
<tr class="odd">
<td align="right">0.01</td>
<td align="right">-0.01</td>
<td align="right">0.04</td>
<td align="right">10</td>
<td align="left">TST</td>
<td align="left">LPA</td>
<td align="left">between</td>
<td align="left">clustermean</td>
</tr>
<tr class="even">
<td align="right">0.01</td>
<td align="right">-0.02</td>
<td align="right">0.05</td>
<td align="right">10</td>
<td align="left">TST</td>
<td align="left">SB</td>
<td align="left">between</td>
<td align="left">clustermean</td>
</tr>
<tr class="odd">
<td align="right">0.05</td>
<td align="right">0.01</td>
<td align="right">0.08</td>
<td align="right">10</td>
<td align="left">TST</td>
<td align="left">WAKE</td>
<td align="left">within</td>
<td align="left">clustermean</td>
</tr>
<tr class="even">
<td align="right">-0.01</td>
<td align="right">-0.02</td>
<td align="right">0.01</td>
<td align="right">10</td>
<td align="left">TST</td>
<td align="left">MVPA</td>
<td align="left">within</td>
<td align="left">clustermean</td>
</tr>
<tr class="odd">
<td align="right">-0.01</td>
<td align="right">-0.02</td>
<td align="right">0.00</td>
<td align="right">10</td>
<td align="left">TST</td>
<td align="left">LPA</td>
<td align="left">within</td>
<td align="left">clustermean</td>
</tr>
<tr class="even">
<td align="right">0.00</td>
<td align="right">-0.01</td>
<td align="right">0.01</td>
<td align="right">10</td>
<td align="left">TST</td>
<td align="left">SB</td>
<td align="left">within</td>
<td align="left">clustermean</td>
</tr>
</tbody>
</table>
<p>A comparison between between- and within-person substitution analyses
of sleep on stress, plot using <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> and
<code>ggpubr::ggarrange()</code> functions.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/" class="external-link">ggpubr</a></span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">subm2</span>, to <span class="op">=</span> <span class="st">"TST"</span>, level <span class="op">=</span> <span class="st">"between"</span>, ref <span class="op">=</span> <span class="st">"clustermean"</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">subm2</span>, to <span class="op">=</span> <span class="st">"TST"</span>, level <span class="op">=</span> <span class="st">"within"</span>, ref <span class="op">=</span> <span class="st">"clustermean"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggarrange</span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, </span>
<span>          ncol <span class="op">=</span> <span class="fl">1</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="mlmcoda-mlmcoda-submargins-1.png" alt="Example of Average Marginal Substitution Analysis"><p class="caption">
Example of Average Marginal Substitution Analysis
</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://github.com/florale" class="external-link">Flora Le</a>, Joshua F. Wiley.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
  <p class="preferably">Using <a href="https://preferably.amirmasoudabdol.name/?source=footer" class="external-link">preferably</a> template.</p>
</div>

    </footer>
</div>





  </body>
</html>
