<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="multilevelcoda">
<!-- Inform modern browsers that this page supports both dark and light color schemes,
  and the page author prefers light. --><meta name="color-scheme" content="dark light">
<script>
  // If `prefers-color-scheme` is not supported, fall back to light mode.
  // i.e. In this case, inject the `light` CSS before the others, with
  // no media filter so that it will be downloaded with highest priority.
  if (window.matchMedia("(prefers-color-scheme: dark)").media === "not all") {
    document.documentElement.style.display = "none";
    document.head.insertAdjacentHTML(
      "beforeend",
      "<link id=\"css\" rel=\"stylesheet\" href=\"https://bootswatch.com/5/flatly/bootstrap.css\" onload=\"document.documentElement.style.display = ''\">"
    );
  }
</script><title>Multilevel Model with Compositional predictors • multilevelcoda</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Multilevel Model with Compositional predictors">
<meta property="og:description" content="multilevelcoda">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Flatly Theme - Light  --><link id="css-light" rel="stylesheet" href="https://bootswatch.com/5/flatly/bootstrap.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<!-- Darkly Theme - Dark --><link id="css-dark" rel="stylesheet" href="https://bootswatch.com/5/darkly/bootstrap.css" media="(prefers-color-scheme: dark)">
<!-- preferably CSS --><link rel="stylesheet" href="../preferably.css">
<link id="css-code-light" rel="stylesheet" href="../code-color-scheme-light.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<link id="css-code-dark" rel="stylesheet" href="../code-color-scheme-dark.css" media="(prefers-color-scheme: dark)">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">multilevelcoda</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/introduction.html">Introduction to Compositional Multilevel Modelling</a>
    <a class="dropdown-item" href="../articles/comp-outcome.html">Multilevel Model with Compositional outcomes</a>
    <a class="dropdown-item" href="../articles/comp-predictor.html">Multilevel Model with Compositional predictors</a>
    <a class="dropdown-item" href="../articles/substitution-model.html">Compositional Multilevel Substitution Model</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/florale/multilevelcoda/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>

        
        
        
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="comp-predictor_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Multilevel Model with Compositional predictors</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/florale/multilevelcoda/blob/HEAD/vignettes/comp-predictor.Rmd" class="external-link"><code>vignettes/comp-predictor.Rmd</code></a></small>
      <div class="d-none name"><code>comp-predictor.Rmd</code></div>
    </div>

    
    
<p>In this vignette, we discuss how to specify multilevel models with compositional data using <code>multilevelcoda</code>.</p>
<p>In addition to <code>multilevelcoda</code> package, we will use <code>brms</code> (to fit models) and <code>bayestestR</code> (to compute useful indices and compare models), and <code>doFuture</code> (to parallel models).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://florale.github.io/multilevelcoda/">multilevelcoda</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms" class="external-link">brms</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://easystats.github.io/bayestestR/" class="external-link">bayestestR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://doFuture.futureverse.org" class="external-link">doFuture</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="co"># reduce number of digits shown</span></span></code></pre></div>
<p>We will also attach built in datasets <code>mcompd</code> (simulated compositional sleep and wake variables) <code>sbp</code> (sequential binary partition), and <code>psub</code> (base possible substitution).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"mcompd"</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"sbp"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"psub"</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="getting-compositions-and-isometric-log-ratio-ilr-coordinates-">Getting compositions and isometric log ratio (ILR) coordinates.<a class="anchor" aria-label="anchor" href="#getting-compositions-and-isometric-log-ratio-ilr-coordinates-"></a>
</h2>
<p>Compositional data are often expressed as a set of ILR coordinates in regression models (Egozcue et al., 2003). Using the <code><a href="../reference/compilr.html">compilr()</a></code>, we can get ILR coordinates that are used in the subsequent model as the predictors or outcomes.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cilr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compilr.html">compilr</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mcompd</span>, sbp <span class="op">=</span> <span class="va">sbp</span>,</span>
<span>                parts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TST"</span>, <span class="st">"WAKE"</span>, <span class="st">"MVPA"</span>, <span class="st">"LPA"</span>, <span class="st">"SB"</span><span class="op">)</span>, idvar <span class="op">=</span> <span class="st">"ID"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="multilevel-model-with-compositional-predictors">Multilevel model with compositional predictors<a class="anchor" aria-label="anchor" href="#multilevel-model-with-compositional-predictors"></a>
</h2>
<p>We now will use output from the <code><a href="../reference/compilr.html">compilr()</a></code> to fit our <code>brms</code> model, using the <code><a href="../reference/brmcoda.html">brmcoda()</a></code>. Here is a model predicting <code>STRESS</code> from between- and within-person sleep-wake behaviours (expressed as ILR coordinates).</p>
<p>Note: make sure you pass the correct names of the ILR coordinates to <code>brms</code> model.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brmcoda.html">brmcoda</a></span><span class="op">(</span>compilr <span class="op">=</span> <span class="va">cilr</span>,</span>
<span>             formula <span class="op">=</span> <span class="va">STRESS</span> <span class="op">~</span> <span class="va">bilr1</span> <span class="op">+</span> <span class="va">bilr2</span> <span class="op">+</span> <span class="va">bilr3</span> <span class="op">+</span> <span class="va">bilr4</span> <span class="op">+</span></span>
<span>               <span class="va">wilr1</span> <span class="op">+</span> <span class="va">wilr2</span> <span class="op">+</span> <span class="va">wilr3</span> <span class="op">+</span> <span class="va">wilr4</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">ID</span><span class="op">)</span>,</span>
<span>             cores <span class="op">=</span> <span class="fl">8</span>, seed <span class="op">=</span> <span class="fl">123</span>, backend <span class="op">=</span> <span class="st">"cmdstanr"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Compiling Stan program...</span></span>
<span><span class="co">#&gt; Start sampling</span></span></code></pre></div>
<p>Here is a <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> of the model results.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m</span><span class="op">$</span><span class="va">Model</span><span class="op">)</span></span>
<span><span class="co">#&gt;  Family: gaussian </span></span>
<span><span class="co">#&gt;   Links: mu = identity; sigma = identity </span></span>
<span><span class="co">#&gt; Formula: STRESS ~ bilr1 + bilr2 + bilr3 + bilr4 + wilr1 + wilr2 + wilr3 + wilr4 + (1 | ID) </span></span>
<span><span class="co">#&gt;    Data: tmp (Number of observations: 3540) </span></span>
<span><span class="co">#&gt;   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;</span></span>
<span><span class="co">#&gt;          total post-warmup draws = 4000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Group-Level Effects: </span></span>
<span><span class="co">#&gt; ~ID (Number of levels: 266) </span></span>
<span><span class="co">#&gt;               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; sd(Intercept)     1.00      0.06     0.88     1.13 1.00     1370     2369</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Population-Level Effects: </span></span>
<span><span class="co">#&gt;           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; Intercept     2.56      0.49     1.64     3.50 1.00     1011     1819</span></span>
<span><span class="co">#&gt; bilr1         0.17      0.33    -0.49     0.82 1.00      987     1601</span></span>
<span><span class="co">#&gt; bilr2         0.41      0.35    -0.28     1.08 1.00      964     2099</span></span>
<span><span class="co">#&gt; bilr3         0.12      0.21    -0.29     0.54 1.00     1091     1861</span></span>
<span><span class="co">#&gt; bilr4        -0.04      0.29    -0.59     0.52 1.00     1001     1775</span></span>
<span><span class="co">#&gt; wilr1        -0.34      0.12    -0.58    -0.10 1.00     3280     3276</span></span>
<span><span class="co">#&gt; wilr2         0.04      0.13    -0.21     0.29 1.00     3576     3033</span></span>
<span><span class="co">#&gt; wilr3        -0.11      0.08    -0.25     0.04 1.00     3196     2789</span></span>
<span><span class="co">#&gt; wilr4         0.24      0.10     0.05     0.43 1.00     3769     2893</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Family Specific Parameters: </span></span>
<span><span class="co">#&gt;       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; sigma     2.37      0.03     2.31     2.42 1.00     5037     3013</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Draws were sampled using sample(hmc). For each parameter, Bulk_ESS</span></span>
<span><span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span><span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></span></code></pre></div>
<p>Results show that the first and forth within-person ILR coordinate was associated with stress. The interpretation of these outputs depends on how you construct your sequential binary partition. For the built-in sequential binary partition <code>sbp</code>, TODO add a table to show partition.</p>
<table class="table">
<thead><tr class="header">
<th>ILR coordinates</th>
<th>What it means</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>bilr1</td>
<td>Sleep vs wake behaviours at between-person level</td>
</tr>
<tr class="even">
<td>bilr2</td>
<td>Sleep vs awake in bed at between-person level</td>
</tr>
<tr class="odd">
<td>bilr3</td>
<td>MVPA vs (LPA and SB) at between-person level</td>
</tr>
<tr class="even">
<td>bilr4</td>
<td>LPA vs SB at between-person level</td>
</tr>
<tr class="odd">
<td>wilr1</td>
<td>Sleep vs wake behaviours at between-person level</td>
</tr>
<tr class="even">
<td>wilr2</td>
<td>Sleep vs awake in bed at within-person level</td>
</tr>
<tr class="odd">
<td>wilr3</td>
<td>MVPA vs (LPA and SB) at within-person level</td>
</tr>
<tr class="even">
<td>wilr4</td>
<td>LPA vs SB at within-person level</td>
</tr>
</tbody>
</table>
<p>Due to the nature of within-person ILR coordinates, it is often challenging to interpret these results in great details. For example, the significant coefficient for wilr1 shows that the within-person change in sleep behaviours (sleep duration and time awake in bed combined), relative to wake behaviours (moderate to vigorous physical activity, light physical activity, and sedentary behaviour) on a given day, was associated with stress. However, as there are several behaviours involved in this coordinate, we don’t know the within-person change in which of them drives the association. It could be the change in sleep, such that people sleep more than their own average on a given day, but it could also be the change in time awake. Further, we don’t know about the specific changes in time spent across behaviours. That is, if people slept more, what behaviour did they spend less time in?</p>
<p>One approach to gain further insights into these relationships, and the changes in outcomes associated with changes in specific time across behaviours is the substitution model. We will discuss the substitution model later in this vignette.</p>
<div class="section level3">
<h3 id="bayes-factor-for-compositional-multilevel-modelling">Bayes factor for compositional multilevel modelling<a class="anchor" aria-label="anchor" href="#bayes-factor-for-compositional-multilevel-modelling"></a>
</h3>
<p>In the frequentist approach, we usually compare the fits of models using <code><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova()</a></code>. In Bayesian, this can be done by comparing the marginal likelihoods of two models.</p>
<p>Bayes Factors (BFs) are indices of relative evidence of one model over another. In the context of compositional multilevel modelling, Bayes Factors provide two main useful functions: - testing single parameters within a model - comparing models</p>
<p>We can utilize Bayes factors to answer the following question:</p>
<p><em>“Which model is more likely to have produced the observed data?”</em></p>
<p><em>Note</em>: To use Bayes factors, <code>brmsfit</code> models must be fitted with an additional non-default argument <code>save_pars = save_pars(all = TRUE)</code>.</p>
<p>Let’s fit a series of model with <code><a href="../reference/brmcoda.html">brmcoda()</a></code> to predict <code>STRESS</code> from sleep-wake composition. For precise Bayes factors, we will use 40,000 posterior draws for each model.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># intercept only model</span></span>
<span><span class="va">m0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brmcoda.html">brmcoda</a></span><span class="op">(</span>compilr <span class="op">=</span> <span class="va">cilr</span>,</span>
<span>             formula <span class="op">=</span> <span class="va">STRESS</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">ID</span><span class="op">)</span>,</span>
<span>             iter <span class="op">=</span> <span class="fl">6000</span>, chains <span class="op">=</span> <span class="fl">8</span>, cores <span class="op">=</span> <span class="fl">8</span>, seed <span class="op">=</span> <span class="fl">123</span>, warmup <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>             backend <span class="op">=</span> <span class="st">"cmdstanr"</span>, save_pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/save_pars.html" class="external-link">save_pars</a></span><span class="op">(</span>all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Compiling Stan program...</span></span>
<span><span class="co">#&gt; Start sampling</span></span>
<span></span>
<span><span class="co"># between-person composition only model</span></span>
<span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brmcoda.html">brmcoda</a></span><span class="op">(</span>compilr <span class="op">=</span> <span class="va">cilr</span>,</span>
<span>             formula <span class="op">=</span> <span class="va">STRESS</span> <span class="op">~</span> <span class="va">bilr1</span> <span class="op">+</span> <span class="va">bilr2</span> <span class="op">+</span> <span class="va">bilr3</span> <span class="op">+</span> <span class="va">bilr4</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">ID</span><span class="op">)</span>,</span>
<span>             iter <span class="op">=</span> <span class="fl">6000</span>, chains <span class="op">=</span> <span class="fl">8</span>, cores <span class="op">=</span> <span class="fl">8</span>, seed <span class="op">=</span> <span class="fl">123</span>, warmup <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>             backend <span class="op">=</span> <span class="st">"cmdstanr"</span>, save_pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/save_pars.html" class="external-link">save_pars</a></span><span class="op">(</span>all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Compiling Stan program...</span></span>
<span><span class="co">#&gt; Start sampling</span></span>
<span></span>
<span><span class="co"># within-person composition only model</span></span>
<span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brmcoda.html">brmcoda</a></span><span class="op">(</span>compilr <span class="op">=</span> <span class="va">cilr</span>,</span>
<span>             formula <span class="op">=</span> <span class="va">STRESS</span> <span class="op">~</span> <span class="va">wilr1</span> <span class="op">+</span> <span class="va">wilr2</span> <span class="op">+</span> <span class="va">wilr3</span> <span class="op">+</span> <span class="va">wilr4</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">ID</span><span class="op">)</span>,</span>
<span>             iter <span class="op">=</span> <span class="fl">6000</span>, chains <span class="op">=</span> <span class="fl">8</span>, cores <span class="op">=</span> <span class="fl">8</span>, seed <span class="op">=</span> <span class="fl">123</span>, warmup <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>             backend <span class="op">=</span> <span class="st">"cmdstanr"</span>, save_pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/save_pars.html" class="external-link">save_pars</a></span><span class="op">(</span>all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Compiling Stan program...</span></span>
<span><span class="co">#&gt; Start sampling</span></span>
<span></span>
<span><span class="co"># full model</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brmcoda.html">brmcoda</a></span><span class="op">(</span>compilr <span class="op">=</span> <span class="va">cilr</span>,</span>
<span>             formula <span class="op">=</span> <span class="va">STRESS</span> <span class="op">~</span> <span class="va">bilr1</span> <span class="op">+</span> <span class="va">bilr2</span> <span class="op">+</span> <span class="va">bilr3</span> <span class="op">+</span> <span class="va">bilr4</span> <span class="op">+</span></span>
<span>               <span class="va">wilr1</span> <span class="op">+</span> <span class="va">wilr2</span> <span class="op">+</span> <span class="va">wilr3</span> <span class="op">+</span> <span class="va">wilr4</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">ID</span><span class="op">)</span>,</span>
<span>             iter <span class="op">=</span> <span class="fl">6000</span>, chains <span class="op">=</span> <span class="fl">8</span>, cores <span class="op">=</span> <span class="fl">8</span>, seed <span class="op">=</span> <span class="fl">123</span>, warmup <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>             backend <span class="op">=</span> <span class="st">"cmdstanr"</span>, save_pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/save_pars.html" class="external-link">save_pars</a></span><span class="op">(</span>all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Compiling Stan program...</span></span>
<span><span class="co">#&gt; Start sampling</span></span></code></pre></div>
<p>We can now compare these models with the <code><a href="https://easystats.github.io/bayestestR/reference/bayesfactor_models.html" class="external-link">bayesfactor_models()</a></code> function, using the intercept-only model as reference.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://easystats.github.io/bayestestR/reference/bayesfactor_models.html" class="external-link">bayesfactor_models</a></span><span class="op">(</span><span class="va">m</span><span class="op">$</span><span class="va">Model</span>, <span class="va">m1</span><span class="op">$</span><span class="va">Model</span>, <span class="va">m2</span><span class="op">$</span><span class="va">Model</span>, denominator <span class="op">=</span> <span class="va">m0</span><span class="op">$</span><span class="va">Model</span><span class="op">)</span></span>
<span><span class="co">#&gt; Computation of Bayes factors: estimating marginal likelihood, please wait...</span></span>
<span><span class="co">#&gt; Recompiling the model with 'rstan'</span></span>
<span><span class="co">#&gt; Recompilation done</span></span>
<span><span class="co">#&gt; Recompiling the model with 'rstan'</span></span>
<span><span class="co">#&gt; Recompilation done</span></span>
<span><span class="co">#&gt; Recompiling the model with 'rstan'</span></span>
<span><span class="co">#&gt; Recompilation done</span></span>
<span><span class="co">#&gt; Recompiling the model with 'rstan'</span></span>
<span><span class="co">#&gt; Recompilation done</span></span>
<span><span class="va">comparison</span></span>
<span><span class="co">#&gt; Bayes Factors for Model Comparison</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Model                                                                       BF</span></span>
<span><span class="co">#&gt; [1] bilr1 + bilr2 + bilr3 + bilr4 + wilr1 + wilr2 + wilr3 + wilr4 + (1 | ID)  4.04</span></span>
<span><span class="co">#&gt; [2] bilr1 + bilr2 + bilr3 + bilr4 + (1 | ID)                                 0.339</span></span>
<span><span class="co">#&gt; [3] wilr1 + wilr2 + wilr3 + wilr4 + (1 | ID)                                 12.00</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; * Against Denominator: [4] 1 + (1 | ID)</span></span>
<span><span class="co">#&gt; *   Bayes Factor Type: marginal likelihoods (bridgesampling)</span></span></code></pre></div>
<p>We can see that model with only within-person composition is the best model - with <span class="math inline">\(BF\)</span> = 11.86 compared to the null (intercept only).</p>
<p>Let’s compare these models against the full model.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">comparison</span>, reference <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Bayes Factors for Model Comparison</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Model                                       BF</span></span>
<span><span class="co">#&gt; [2] bilr1 + bilr2 + bilr3 + bilr4 + (1 | ID) 0.084</span></span>
<span><span class="co">#&gt; [3] wilr1 + wilr2 + wilr3 + wilr4 + (1 | ID)  2.97</span></span>
<span><span class="co">#&gt; [4] 1 + (1 | ID)                             0.248</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; * Against Denominator: [1] bilr1 + bilr2 + bilr3 + bilr4 + wilr1 + wilr2 + wilr3 + wilr4 + (1 | ID)</span></span>
<span><span class="co">#&gt; *   Bayes Factor Type: marginal likelihoods (bridgesampling)</span></span></code></pre></div>
<p>Again, our data favours the within-person composition only model over the full model, giving 2.93 times more support.</p>
<p>Bayes factors provide a intuitive measure of the strength of evidence of one model over the other or among different models. Check out the <code>bayestestR</code> packages for several other useful functions related to BFs.</p>
</div>
</div>
<div class="section level2">
<h2 id="substitution-model">Substitution model<a class="anchor" aria-label="anchor" href="#substitution-model"></a>
</h2>
<p>When examining the relationships between compositional data and an outcome, we often are also interested in the changes in an outcomes when a fixed duration of time is reallocated from one behaviour to another, while the other behaviours remain constant. These changes can be examined using the compositional isotemporal substitution model (Dumuid et a., 2019). In <code>multilevelcoda</code>, we extend this model to multilevel approach to test both between-person and within-person changes.</p>
<div class="section level3">
<h3 id="between-person-substitution-model">Between-person substitution model<a class="anchor" aria-label="anchor" href="#between-person-substitution-model"></a>
</h3>
<p>Between-person substitution model can be computed using the <code><a href="../reference/bsub.html">bsub()</a></code> function. The below example examines the changes in stress for different pairwise substitution of sleep-wake behaviours for a period of 1 to 5 minutes, at between-person level.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bsubm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bsub.html">bsub</a></span><span class="op">(</span>objec <span class="op">=</span> <span class="va">m</span>, substitute <span class="op">=</span> <span class="va">psub</span>, minute <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p>Output from <code><a href="../reference/bsub.html">bsub()</a></code> contains multiple dataset of results for all available compositional component. Here are the results for changes in stress when sleep (TST) is substituted for 5 minutes, averaged across levels of covariates. For ease of presentation, we only show the <span class="math inline">\(\pm5\)</span> minute substitution results, but the full dataset would contain similar results for 1, 2, etc. minute substitutions.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">bsubm</span><span class="op">$</span><span class="va">TST</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">MinSubstituted</span><span class="op">)</span> <span class="op">==</span> <span class="fl">5</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">Mean</th>
<th align="right">CI_low</th>
<th align="right">CI_high</th>
<th align="right">MinSubstituted</th>
<th align="left">Substitute</th>
<th align="left">Predictor</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.021</td>
<td align="right">-0.011</td>
<td align="right">0.053</td>
<td align="right">5</td>
<td align="left">WAKE</td>
<td align="left">TST</td>
</tr>
<tr class="even">
<td align="right">0.003</td>
<td align="right">-0.014</td>
<td align="right">0.019</td>
<td align="right">5</td>
<td align="left">MVPA</td>
<td align="left">TST</td>
</tr>
<tr class="odd">
<td align="right">0.005</td>
<td align="right">-0.007</td>
<td align="right">0.018</td>
<td align="right">5</td>
<td align="left">LPA</td>
<td align="left">TST</td>
</tr>
<tr class="even">
<td align="right">0.006</td>
<td align="right">-0.008</td>
<td align="right">0.021</td>
<td align="right">5</td>
<td align="left">SB</td>
<td align="left">TST</td>
</tr>
<tr class="odd">
<td align="right">-0.020</td>
<td align="right">-0.049</td>
<td align="right">0.010</td>
<td align="right">-5</td>
<td align="left">WAKE</td>
<td align="left">TST</td>
</tr>
<tr class="even">
<td align="right">-0.003</td>
<td align="right">-0.019</td>
<td align="right">0.014</td>
<td align="right">-5</td>
<td align="left">MVPA</td>
<td align="left">TST</td>
</tr>
<tr class="odd">
<td align="right">-0.005</td>
<td align="right">-0.018</td>
<td align="right">0.007</td>
<td align="right">-5</td>
<td align="left">LPA</td>
<td align="left">TST</td>
</tr>
<tr class="even">
<td align="right">-0.006</td>
<td align="right">-0.021</td>
<td align="right">0.008</td>
<td align="right">-5</td>
<td align="left">SB</td>
<td align="left">TST</td>
</tr>
</tbody>
</table>
<p>None of the results are significant, given that the credible intervals did not cross 0, showing that increasing sleep (TST) at the expense of any other behaviours was not associated in changes in stress.</p>
<p>These results can be plotted to see the patterns more easily using the <code><a href="../reference/plotsub.html">plotsub()</a></code> function.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotsub.html">plotsub</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bsubm</span><span class="op">$</span><span class="va">TST</span>, x <span class="op">=</span> <span class="st">"sleep"</span>, y <span class="op">=</span> <span class="st">"stress"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_jco</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_jco</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="mlmcoda-mlmcoda-plotbsubm2-1.png" alt=""><p class="caption">plot of chunk mlmcoda-plotbsubm2</p>
</div>
<div class="section level4">
<h4 id="within-person-substitution-model">Within-person substitution model<a class="anchor" aria-label="anchor" href="#within-person-substitution-model"></a>
</h4>
<p>Let’s now take a look at how stress changes when different pairwise of sleep-wake behaviours are substituted for a period of 1 to 5 minutes, at within-person level.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Within-person substitution</span></span>
<span><span class="va">wsubm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wsub.html">wsub</a></span><span class="op">(</span>objec <span class="op">=</span> <span class="va">m</span>, substitute <span class="op">=</span> <span class="va">psub</span>, minute <span class="op">=</span> <span class="fl">5</span>, summary <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Results for 5 minute substitution.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">wsubm</span><span class="op">$</span><span class="va">TST</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">MinSubstituted</span><span class="op">)</span> <span class="op">==</span> <span class="fl">5</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">Mean</th>
<th align="right">CI_low</th>
<th align="right">CI_high</th>
<th align="right">MinSubstituted</th>
<th align="left">Substitute</th>
<th align="left">Predictor</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.017</td>
<td align="right">0.002</td>
<td align="right">0.032</td>
<td align="right">5</td>
<td align="left">WAKE</td>
<td align="left">TST</td>
</tr>
<tr class="even">
<td align="right">-0.003</td>
<td align="right">-0.009</td>
<td align="right">0.003</td>
<td align="right">5</td>
<td align="left">MVPA</td>
<td align="left">TST</td>
</tr>
<tr class="odd">
<td align="right">-0.005</td>
<td align="right">-0.009</td>
<td align="right">0.000</td>
<td align="right">5</td>
<td align="left">LPA</td>
<td align="left">TST</td>
</tr>
<tr class="even">
<td align="right">-0.002</td>
<td align="right">-0.007</td>
<td align="right">0.003</td>
<td align="right">5</td>
<td align="left">SB</td>
<td align="left">TST</td>
</tr>
<tr class="odd">
<td align="right">-0.016</td>
<td align="right">-0.029</td>
<td align="right">-0.002</td>
<td align="right">-5</td>
<td align="left">WAKE</td>
<td align="left">TST</td>
</tr>
<tr class="even">
<td align="right">0.003</td>
<td align="right">-0.003</td>
<td align="right">0.009</td>
<td align="right">-5</td>
<td align="left">MVPA</td>
<td align="left">TST</td>
</tr>
<tr class="odd">
<td align="right">0.005</td>
<td align="right">0.000</td>
<td align="right">0.009</td>
<td align="right">-5</td>
<td align="left">LPA</td>
<td align="left">TST</td>
</tr>
<tr class="even">
<td align="right">0.002</td>
<td align="right">-0.003</td>
<td align="right">0.007</td>
<td align="right">-5</td>
<td align="left">SB</td>
<td align="left">TST</td>
</tr>
</tbody>
</table>
<p>At within-person level, we got some significant results for substitution of sleep (TST) and time awake in bed (WAKE) for 5 minutes, but not other behaviours. Increasing sleep at the expense of time spent awake in bed predicted 0.02 higher stress [95% CI 0.00, 0.03], on a given day. Conversely, less sleep and more time awake in bed predicted less stress (b = -0.016 [95% CI -0.03, -0.00]). Notice there is no column indicating the levels of convariates, indicating that these results have been averaged.</p>
<p>Let’s also plot theses results.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotsub.html">plotsub</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">wsubm</span><span class="op">$</span><span class="va">TST</span>, x <span class="op">=</span> <span class="st">"sleep"</span>, y <span class="op">=</span> <span class="st">"stress"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_jco</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_jco</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="mlmcoda-mlmcoda-plotwsubm2-1.png" alt=""><p class="caption">plot of chunk mlmcoda-plotwsubm2</p>
</div>
</div>
<div class="section level4">
<h4 id="more-about-interesting-substitution-models">More about interesting substitution models<a class="anchor" aria-label="anchor" href="#more-about-interesting-substitution-models"></a>
</h4>
<p>If you are interested in conducting substitution models, we recommend LINK TO SUB MODEL ViGNETTES.</p>
</div>
</div>
<div class="section level3">
<h3 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<p>Dumuid, D., Pedišić, Ž., Stanford, T. E., Martín-Fernández, J. A., Hron, K., Maher, C. A., … &amp; Olds, T. (2019). The compositional isotemporal substitution model: a method for estimating changes in a health outcome for reallocation of time between sleep, physical activity and sedentary behaviour. Statistical methods in medical research, 28(3), 846-857.</p>
<p>Egozcue, J. J., Pawlowsky-Glahn, V., Mateu-Figueras, G., &amp; Barcelo-Vidal, C. (2003). Isometric logratio transformations for compositional data analysis. Mathematical geology, 35(3), 279-300.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://github.com/florale" class="external-link">Flora Le</a>, Joshua F. Wiley.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
  <p class="preferably">Using <a href="https://preferably.amirmasoudabdol.name/?source=footer" class="external-link">preferably</a> template.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
